"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("fs"),t=require("path");function r(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}"function"==typeof SuppressedError&&SuppressedError;var i,o,s,a={exports:{}};i=a,o="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(o=o||__filename),s=function(r={}){var n,i,s=r;s.ready=new Promise(((e,t)=>{n=e,i=t}));var a,c,u,_=Object.assign({},s),A="object"==typeof window,f="function"==typeof importScripts,h="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,l="";if(h){var p=e,d=t;l=f?d.dirname(l)+"/":__dirname+"/",a=(e,t)=>(e=x(e)?new URL(e):d.normalize(e),p.readFileSync(e,t?void 0:"utf8")),u=e=>{var t=a(e,!0);return t.buffer||(t=new Uint8Array(t)),t},c=(e,t,r,n=!0)=>{e=x(e)?new URL(e):d.normalize(e),p.readFile(e,n?void 0:"utf8",((e,i)=>{e?r(e):t(n?i.buffer:i)}))},!s.thisProgram&&process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),s.inspect=()=>"[Emscripten Module object]"}else(A||f)&&(f?l=self.location.href:"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),o&&(l=o),l=0!==l.indexOf("blob:")?l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):"",a=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},f&&(u=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),c=(e,t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?t(n.response):r()},n.onerror=r,n.send(null)});var R,y,m,B=s.print||console.log.bind(console),g=s.printErr||console.error.bind(console);Object.assign(s,_),_=null,s.arguments&&s.arguments,s.thisProgram&&s.thisProgram,s.quit&&s.quit,s.wasmBinary&&(R=s.wasmBinary),s.noExitRuntime,"object"!=typeof WebAssembly&&T("no native wasm support detected");var E,Z,I=!1;function v(){var e=y.buffer;s.HEAP8=new Int8Array(e),s.HEAP16=new Int16Array(e),s.HEAP32=new Int32Array(e),s.HEAPU8=E=new Uint8Array(e),s.HEAPU16=new Uint16Array(e),s.HEAPU32=Z=new Uint32Array(e),s.HEAPF32=new Float32Array(e),s.HEAPF64=new Float64Array(e)}var S=[],b=[],C=[],N=0,w=null;function T(e){s.onAbort&&s.onAbort(e),g(e="Aborted("+e+")"),I=!0,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw i(t),t}var P,O,D="data:application/octet-stream;base64,";function F(e){return e.startsWith(D)}function x(e){return e.startsWith("file://")}function U(e){if(e==P&&R)return new Uint8Array(R);if(u)return u(e);throw"both async and sync fetching of the wasm failed"}function G(e,t,r){return function(e){if(!R&&(A||f)){if("function"==typeof fetch&&!x(e))return fetch(e,{credentials:"same-origin"}).then((t=>{if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()})).catch((()=>U(e)));if(c)return new Promise(((t,r)=>{c(e,(e=>t(new Uint8Array(e))),r)}))}return Promise.resolve().then((()=>U(e)))}(e).then((e=>WebAssembly.instantiate(e,t))).then((e=>e)).then(r,(e=>{g("failed to asynchronously prepare wasm: "+e),T(e)}))}F(P="zbar.wasm")||(O=P,P=s.locateFile?s.locateFile(O,l):l+O);var H,M=e=>{for(;e.length>0;)e.shift()(s)},L=e=>{var t=e-y.buffer.byteLength+65535>>>16;try{return y.grow(t),v(),1}catch(e){}},W="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,k=[null,[],[]],Y=(e,t)=>{var r=k[e];0===t||10===t?((1===e?B:g)(((e,t,r)=>{for(var n=t+r,i=t;e[i]&&!(i>=n);)++i;if(i-t>16&&e.buffer&&W)return W.decode(e.subarray(t,i));for(var o="";t<i;){var s=e[t++];if(128&s){var a=63&e[t++];if(192!=(224&s)){var c=63&e[t++];if((s=224==(240&s)?(15&s)<<12|a<<6|c:(7&s)<<18|a<<12|c<<6|63&e[t++])<65536)o+=String.fromCharCode(s);else{var u=s-65536;o+=String.fromCharCode(55296|u>>10,56320|1023&u)}}else o+=String.fromCharCode((31&s)<<6|a)}else o+=String.fromCharCode(s)}return o})(r,0)),r.length=0):r.push(t)},q={d:()=>!0,e:function(){return Date.now()},c:e=>{var t=E.length,r=2147483648;if((e>>>=0)>r)return!1;for(var n,i,o=1;o<=4;o*=2){var s=t*(1+.2/o);s=Math.min(s,e+100663296);var a=Math.min(r,(n=Math.max(e,s))+((i=65536)-n%i)%i);if(L(a))return!0}return!1},f:e=>52,b:function(e,t,r,n,i){return 70},a:(e,t,r,n)=>{for(var i=0,o=0;o<r;o++){var s=Z[t>>2],a=Z[t+4>>2];t+=8;for(var c=0;c<a;c++)Y(e,E[s+c]);i+=a}return Z[n>>2]=i,0}};function j(){function e(){H||(H=!0,s.calledRun=!0,I||(M(b),n(s),s.onRuntimeInitialized&&s.onRuntimeInitialized(),function(){if(s.postRun)for("function"==typeof s.postRun&&(s.postRun=[s.postRun]);s.postRun.length;)e=s.postRun.shift(),C.unshift(e);var e;M(C)}()))}N>0||(function(){if(s.preRun)for("function"==typeof s.preRun&&(s.preRun=[s.preRun]);s.preRun.length;)e=s.preRun.shift(),S.unshift(e);var e;M(S)}(),N>0||(s.setStatus?(s.setStatus("Running..."),setTimeout((function(){setTimeout((function(){s.setStatus("")}),1),e()}),1)):e()))}if(function(){var e,t,r,n,o={a:q};function a(e,t){var r,n=e.exports;return y=(m=n).g,v(),m.s,r=m.h,b.unshift(r),function(e){if(N--,s.monitorRunDependencies&&s.monitorRunDependencies(N),0==N&&w){var t=w;w=null,t()}}(),n}if(N++,s.monitorRunDependencies&&s.monitorRunDependencies(N),s.instantiateWasm)try{return s.instantiateWasm(o,a)}catch(e){g("Module.instantiateWasm callback failed with error: "+e),i(e)}(e=R,t=P,r=o,n=function(e){a(e.instance)},e||"function"!=typeof WebAssembly.instantiateStreaming||F(t)||x(t)||h||"function"!=typeof fetch?G(t,r,n):fetch(t,{credentials:"same-origin"}).then((e=>WebAssembly.instantiateStreaming(e,r).then(n,(function(e){return g("wasm streaming compile failed: "+e),g("falling back to ArrayBuffer instantiation"),G(t,r,n)}))))).catch(i)}(),s._ImageScanner_create=()=>(s._ImageScanner_create=m.i)(),s._ImageScanner_destory=e=>(s._ImageScanner_destory=m.j)(e),s._ImageScanner_set_config=(e,t,r,n)=>(s._ImageScanner_set_config=m.k)(e,t,r,n),s._ImageScanner_enable_cache=(e,t)=>(s._ImageScanner_enable_cache=m.l)(e,t),s._ImageScanner_recycle_image=(e,t)=>(s._ImageScanner_recycle_image=m.m)(e,t),s._ImageScanner_get_results=e=>(s._ImageScanner_get_results=m.n)(e),s._ImageScanner_scan=(e,t)=>(s._ImageScanner_scan=m.o)(e,t),s._Image_create=(e,t,r,n,i,o)=>(s._Image_create=m.p)(e,t,r,n,i,o),s._Image_destory=e=>(s._Image_destory=m.q)(e),s._Image_get_symbols=e=>(s._Image_get_symbols=m.r)(e),s._free=e=>(s._free=m.t)(e),s._malloc=e=>(s._malloc=m.u)(e),w=function e(){H||j(),H||(w=e)},s.preInit)for("function"==typeof s.preInit&&(s.preInit=[s.preInit]);s.preInit.length>0;)s.preInit.pop()();return j(),r.ready},i.exports=s;const c=n(a.exports);let u;function _(e={}){u=function(){return r(this,void 0,void 0,(function*(){const t=yield c(e);if(t)return t;throw Error("WASM was not loaded")}))}()}function A(){return r(this,void 0,void 0,(function*(){return u||_(),yield u}))}var f,h,l;exports.ZBarSymbolType=void 0,(f=exports.ZBarSymbolType||(exports.ZBarSymbolType={}))[f.ZBAR_NONE=0]="ZBAR_NONE",f[f.ZBAR_PARTIAL=1]="ZBAR_PARTIAL",f[f.ZBAR_EAN2=2]="ZBAR_EAN2",f[f.ZBAR_EAN5=5]="ZBAR_EAN5",f[f.ZBAR_EAN8=8]="ZBAR_EAN8",f[f.ZBAR_UPCE=9]="ZBAR_UPCE",f[f.ZBAR_ISBN10=10]="ZBAR_ISBN10",f[f.ZBAR_UPCA=12]="ZBAR_UPCA",f[f.ZBAR_EAN13=13]="ZBAR_EAN13",f[f.ZBAR_ISBN13=14]="ZBAR_ISBN13",f[f.ZBAR_COMPOSITE=15]="ZBAR_COMPOSITE",f[f.ZBAR_I25=25]="ZBAR_I25",f[f.ZBAR_DATABAR=34]="ZBAR_DATABAR",f[f.ZBAR_DATABAR_EXP=35]="ZBAR_DATABAR_EXP",f[f.ZBAR_CODABAR=38]="ZBAR_CODABAR",f[f.ZBAR_CODE39=39]="ZBAR_CODE39",f[f.ZBAR_PDF417=57]="ZBAR_PDF417",f[f.ZBAR_QRCODE=64]="ZBAR_QRCODE",f[f.ZBAR_SQCODE=80]="ZBAR_SQCODE",f[f.ZBAR_CODE93=93]="ZBAR_CODE93",f[f.ZBAR_CODE128=128]="ZBAR_CODE128",f[f.ZBAR_SYMBOL=255]="ZBAR_SYMBOL",f[f.ZBAR_ADDON2=512]="ZBAR_ADDON2",f[f.ZBAR_ADDON5=1280]="ZBAR_ADDON5",f[f.ZBAR_ADDON=1792]="ZBAR_ADDON",exports.ZBarConfigType=void 0,(h=exports.ZBarConfigType||(exports.ZBarConfigType={}))[h.ZBAR_CFG_ENABLE=0]="ZBAR_CFG_ENABLE",h[h.ZBAR_CFG_ADD_CHECK=1]="ZBAR_CFG_ADD_CHECK",h[h.ZBAR_CFG_EMIT_CHECK=2]="ZBAR_CFG_EMIT_CHECK",h[h.ZBAR_CFG_ASCII=3]="ZBAR_CFG_ASCII",h[h.ZBAR_CFG_BINARY=4]="ZBAR_CFG_BINARY",h[h.ZBAR_CFG_NUM=5]="ZBAR_CFG_NUM",h[h.ZBAR_CFG_MIN_LEN=32]="ZBAR_CFG_MIN_LEN",h[h.ZBAR_CFG_MAX_LEN=33]="ZBAR_CFG_MAX_LEN",h[h.ZBAR_CFG_UNCERTAINTY=64]="ZBAR_CFG_UNCERTAINTY",h[h.ZBAR_CFG_POSITION=128]="ZBAR_CFG_POSITION",h[h.ZBAR_CFG_TEST_INVERTED=129]="ZBAR_CFG_TEST_INVERTED",h[h.ZBAR_CFG_X_DENSITY=256]="ZBAR_CFG_X_DENSITY",h[h.ZBAR_CFG_Y_DENSITY=257]="ZBAR_CFG_Y_DENSITY",exports.ZBarOrientation=void 0,(l=exports.ZBarOrientation||(exports.ZBarOrientation={}))[l.ZBAR_ORIENT_UNKNOWN=-1]="ZBAR_ORIENT_UNKNOWN",l[l.ZBAR_ORIENT_UP=0]="ZBAR_ORIENT_UP",l[l.ZBAR_ORIENT_RIGHT=1]="ZBAR_ORIENT_RIGHT",l[l.ZBAR_ORIENT_DOWN=2]="ZBAR_ORIENT_DOWN",l[l.ZBAR_ORIENT_LEFT=3]="ZBAR_ORIENT_LEFT";class p{constructor(e,t){this.ptr=e,this.inst=t}checkAlive(){if(!this.ptr)throw Error("Call after destroyed")}getPointer(){return this.checkAlive(),this.ptr}}class d{constructor(e,t){this.ptr=e,this.ptr32=e>>2,this.buf=t,this.HEAP8=new Int8Array(t),this.HEAPU32=new Uint32Array(t),this.HEAP32=new Int32Array(t)}}class R extends d{get type(){return this.HEAPU32[this.ptr32]}get data(){const e=this.HEAPU32[this.ptr32+4],t=this.HEAPU32[this.ptr32+5];return Int8Array.from(this.HEAP8.subarray(t,t+e))}get points(){const e=this.HEAPU32[this.ptr32+7],t=this.HEAPU32[this.ptr32+8]>>2,r=[];for(let n=0;n<e;++n){const e=this.HEAP32[t+2*n],i=this.HEAP32[t+2*n+1];r.push({x:e,y:i})}return r}get orientation(){return this.HEAP32[this.ptr32+9]}get next(){const e=this.HEAPU32[this.ptr32+11];return e?new R(e,this.buf):null}get time(){return this.HEAPU32[this.ptr32+13]}get cacheCount(){return this.HEAP32[this.ptr32+14]}get quality(){return this.HEAP32[this.ptr32+15]}}class y extends d{get head(){const e=this.HEAPU32[this.ptr32+2];return e?new R(e,this.buf):null}}class m{constructor(e){this.type=e.type,this.typeName=exports.ZBarSymbolType[this.type],this.data=e.data,this.points=e.points,this.orientation=e.orientation,this.time=e.time,this.cacheCount=e.cacheCount,this.quality=e.quality}static createSymbolsFromPtr(e,t){if(0==e)return[];let r=new y(e,t).head;const n=[];for(;null!==r;)n.push(new m(r)),r=r.next;return n}decode(e){return new TextDecoder(e).decode(this.data)}}class B extends p{static createFromGrayBuffer(e,t,n,i=0){return r(this,void 0,void 0,(function*(){const r=yield A(),o=new Uint8Array(n),s=e*t;if(s!==o.byteLength)throw Error(`data length (${o.byteLength} bytes) does not match width and height (${s} bytes)`);const a=r._malloc(s);r.HEAPU8.set(o,a);return new this(r._Image_create(e,t,808466521,a,s,i),r)}))}static createFromRGBABuffer(e,t,n,i=0){return r(this,void 0,void 0,(function*(){const r=yield A(),o=new Uint8Array(n),s=e*t;if(4*s!==o.byteLength)throw Error(`data length (${o.byteLength} bytes) does not match width and height (${4*s} bytes)`);const a=r._malloc(s),c=a+s,u=r.HEAPU8;for(let e=a,t=0;e<c;e++,t+=4)u[e]=19595*o[t]+38469*o[t+1]+7472*o[t+2]>>16;return new this(r._Image_create(e,t,808466521,a,s,i),r)}))}destroy(){this.checkAlive(),this.inst._Image_destory(this.ptr),this.ptr=0}getSymbols(){this.checkAlive();const e=this.inst._Image_get_symbols(this.ptr);return m.createSymbolsFromPtr(e,this.inst.HEAPU8.buffer)}}class g extends p{static create(){return r(this,void 0,void 0,(function*(){const e=yield A();return new this(e._ImageScanner_create(),e)}))}destroy(){this.checkAlive(),this.inst._ImageScanner_destory(this.ptr),this.ptr=0}setConfig(e,t,r){return this.checkAlive(),this.inst._ImageScanner_set_config(this.ptr,e,t,r)}enableCache(e=!0){this.checkAlive(),this.inst._ImageScanner_enable_cache(this.ptr,e)}recycleImage(e){this.checkAlive(),this.inst._ImageScanner_recycle_image(this.ptr,e.getPointer())}getResults(){this.checkAlive();const e=this.inst._ImageScanner_get_results(this.ptr);return m.createSymbolsFromPtr(e,this.inst.HEAPU8.buffer)}scan(e){return this.checkAlive(),this.inst._ImageScanner_scan(this.ptr,e.getPointer())}}const E=()=>r(void 0,void 0,void 0,(function*(){const e=yield g.create();return e.setConfig(exports.ZBarSymbolType.ZBAR_NONE,exports.ZBarConfigType.ZBAR_CFG_BINARY,1),e}));let Z;const I=(e,t)=>r(void 0,void 0,void 0,(function*(){void 0===t&&(t=Z||(yield E()),Z=t);const r=t.scan(e);if(r<0)throw Error("Scan Failed");return 0===r?[]:e.getSymbols()})),v=(e,t,n,i)=>r(void 0,void 0,void 0,(function*(){const r=yield B.createFromRGBABuffer(t,n,e),o=yield I(r,i);return r.destroy(),o}));exports.ZBarImage=B,exports.ZBarScanner=g,exports.ZBarSymbol=m,exports.getDefaultScanner=E,exports.getInstance=A,exports.scanGrayBuffer=(e,t,n,i)=>r(void 0,void 0,void 0,(function*(){const r=yield B.createFromGrayBuffer(t,n,e),o=yield I(r,i);return r.destroy(),o})),exports.scanImageData=(e,t)=>r(void 0,void 0,void 0,(function*(){return yield v(e.data.buffer,e.width,e.height,t)})),exports.scanRGBABuffer=v,exports.setModuleArgs=_;
//# sourceMappingURL=main.cjs.map
